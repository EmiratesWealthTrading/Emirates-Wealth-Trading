<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Emirates Wealth Trading</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #8A2BE2, #00CED1, #FF00FF);
            --secondary-gradient: linear-gradient(135deg, #FF00FF, #8A2BE2);
            --card-bg: rgba(25, 25, 35, 0.7);
            --card-border: rgba(255, 255, 255, 0.1);
            --text-primary: #FFFFFF;
            --text-secondary: #CCCCCC;
            --accent: #00CED1;
            --accent-secondary: #FF00FF;
            --error: #FF3366;
            --success: #00FF99;
            --warning: #FFCC00;
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            --inner-shadow: inset 0 2px 10px rgba(255, 255, 255, 0.1);
            --transition: all 0.3s ease;
            --glow: 0 0 15px rgba(138, 43, 226, 0.6);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 16px;
            padding-bottom: 80px;
            overflow-x: hidden;
        }

        .app-container {
            max-width: 420px;
            margin: 0 auto;
        }

        /* Glassmorphism card */
        .card {
            background: var(--card-bg);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: 24px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            border: 1px solid var(--card-border);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            z-index: -1;
            background: var(--primary-gradient);
            border-radius: 25px;
            opacity: 0.3;
        }

        .card:hover {
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
            transform: translateY(-5px);
        }

        /* Neon gradient text */
        .gradient-text {
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-weight: 700;
        }

        /* Buttons with 3D effect */
        .btn {
            background: var(--primary-gradient);
            color: white;
            border: none;
            padding: 14px 24px;
            border-radius: 16px;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(138, 43, 226, 0.4), 0 2px 0 rgba(255, 255, 255, 0.2);
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .btn:active {
            transform: translateY(2px);
            box-shadow: 0 2px 10px rgba(138, 43, 226, 0.4), 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        /* Form elements */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .form-input {
            width: 100%;
            padding: 14px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(0, 0, 0, 0.2);
            color: var(--text-primary);
            font-size: 16px;
            transition: var(--transition);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 2px rgba(0, 206, 209, 0.3);
        }

        /* Bottom navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(25, 25, 35, 0.9);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            display: flex;
            justify-content: space-around;
            padding: 12px 0;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 1000;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 8px 16px;
            border-radius: 16px;
            transition: var(--transition);
        }

        .nav-item.active {
            background: rgba(138, 43, 226, 0.2);
        }

        .nav-icon {
            font-size: 20px;
            margin-bottom: 4px;
        }

        .nav-label {
            font-size: 12px;
        }

        /* VIP Package Cards */
        .packages-container {
            display: flex;
            overflow-x: auto;
            padding: 10px 0;
            scroll-snap-type: x mandatory;
            gap: 16px;
            margin-bottom: 20px;
        }

        .package-card {
            flex: 0 0 auto;
            width: 280px;
            scroll-snap-align: start;
            background: var(--card-bg);
            border-radius: 20px;
            padding: 20px;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .package-card.locked {
            opacity: 0.7;
            filter: grayscale(0.5);
        }

        .vip-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--primary-gradient);
            color: white;
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 10px rgba(0, 206, 209, 0.6); }
            50% { box-shadow: 0 0 20px rgba(0, 206, 209, 0.8), 0 0 30px rgba(0, 206, 209, 0.4); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease forwards;
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        .shake {
            animation: shake 0.5s;
        }

        .glow {
            animation: glow 1.5s infinite;
        }

        /* Toast notifications */
        .toast {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--card-bg);
            color: var(--text-primary);
            padding: 12px 20px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            z-index: 1001;
            display: flex;
            align-items: center;
            gap: 10px;
            max-width: 90%;
        }

        .toast.success {
            border-left: 4px solid var(--success);
        }

        .toast.error {
            border-left: 4px solid var(--error);
        }

        /* Transaction list */
        .transaction-item {
            display: flex;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .transaction-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            background: rgba(0, 255, 153, 0.2);
        }

        .transaction-details {
            flex: 1;
        }

        .transaction-amount {
            font-weight: 600;
        }

        .transaction-positive {
            color: var(--success);
        }

        .transaction-negative {
            color: var(--error);
        }

        /* Screen management */
        .screen {
            display: none;
        }

        .screen.active {
            display: block;
            animation: fadeIn 0.4s ease;
        }

        /* Header styles */
        .app-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 10px 0;
        }

        .logo {
            font-size: 24px;
            font-weight: 800;
        }

        .user-badge {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(138, 43, 226, 0.2);
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 14px;
        }

        .vip-indicator {
            color: gold;
        }

        /* Scrolling banner */
        .scrolling-banner {
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 12px;
            margin-bottom: 20px;
            overflow: hidden;
            position: relative;
            height: 40px;
        }

        .banner-content {
            position: absolute;
            white-space: nowrap;
            animation: scroll 20s linear infinite;
        }

        @keyframes scroll {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }

        /* Balance display */
        .balance-display {
            text-align: center;
            margin-bottom: 20px;
        }

        .balance-amount {
            font-size: 36px;
            font-weight: 700;
            margin: 10px 0;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        /* Quick actions */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .action-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 12px;
            background: var(--card-bg);
            border-radius: 16px;
            transition: var(--transition);
        }

        .action-btn:active {
            transform: scale(0.95);
        }

        .action-icon {
            font-size: 20px;
            margin-bottom: 8px;
        }

        .action-label {
            font-size: 12px;
        }

        /* Code input styling */
        .code-inputs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .code-input {
            width: 50px;
            height: 60px;
            text-align: center;
            font-size: 24px;
            border-radius: 12px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            background: rgba(0, 0, 0, 0.2);
            color: var(--text-primary);
        }

        .code-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 10px rgba(0, 206, 209, 0.5);
        }

        /* Responsive adjustments */
        @media (max-width: 360px) {
            .card {
                padding: 16px;
            }
            
            .btn {
                padding: 12px 20px;
            }
            
            .quick-actions {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }
            
            .code-input {
                width: 40px;
                height: 50px;
                font-size: 20px;
            }
        }

        /* Icon styling */
        .icon-sm {
            font-size: 18px;
            width: 22px;
            height: 22px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        /* Referral section */
        .referral-code {
            background: rgba(138, 43, 226, 0.2);
            padding: 12px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        /* Progress bar */
        .progress-container {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-bar {
            height: 100%;
            background: var(--primary-gradient);
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        
        /* Contact section */
        .contact-item {
            display: flex;
            align-items: center;
            padding: 12px;
            margin-bottom: 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            transition: var(--transition);
        }
        
        .contact-item:active {
            transform: scale(0.98);
        }
        
        .contact-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            background: var(--primary-gradient);
        }
        
        /* Optional label */
        .optional-label {
            font-size: 12px;
            color: var(--text-secondary);
            font-style: italic;
            margin-left: 5px;
        }
        
        /* Welcome message */
        .welcome-message {
            text-align: center;
            margin-bottom: 20px;
            font-size: 18px;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-weight: 600;
        }
        
        /* Profile screen */
        .profile-section {
            margin-bottom: 20px;
        }
        
        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: var(--primary-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 16px;
            font-size: 32px;
        }
        
        .required-field::after {
            content: " *";
            color: var(--error);
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Auth Screen -->
        <div id="auth-screen" class="screen active">
            <div class="card" style="text-align: center; margin-top: 40px;">
                <h1 class="logo gradient-text" style="font-size: 32px; margin-bottom: 30px;">Emirates Wealth Trading</h1>
                <p style="margin-bottom: 24px; color: var(--text-secondary);">Sign in or create an account to start earning</p>
                
                <div class="form-group">
                    <input type="email" class="form-input" id="login-email" placeholder="Email address">
                </div>
                
                <div class="form-group">
                    <input type="password" class="form-input" id="login-password" placeholder="Password">
                </div>
                
                <button class="btn" style="width: 100%; margin-bottom: 16px;" id="login-btn">
                    <i class="fas fa-sign-in-alt icon-sm" style="margin-right: 8px;"></i> Sign In
                </button>
                
                <p style="margin: 20px 0; color: var(--text-secondary);">Or continue with</p>
                
                <div style="display: flex; gap: 12px; margin-bottom: 20px;">
                    <button class="btn" style="flex: 1; background: linear-gradient(135deg, #DB4437, #EA4335);" id="gmail-btn">
                        <i class="fab fa-google icon-sm" style="margin-right: 8px;"></i> Gmail
                    </button>
                    <button class="btn" style="flex: 1; background: linear-gradient(135deg, #4267B2, #3B5998);" id="facebook-btn">
                        <i class="fab fa-facebook-f icon-sm" style="margin-right: 8px;"></i> Facebook
                    </button>
                </div>
                
                <div style="font-size: 14px;">
                    <p>Don't have an account? <a href="#" style="color: var(--accent); text-decoration: none;" id="signup-link">Sign Up</a></p>
                    <p><a href="#" style="color: var(--accent-secondary); text-decoration: none;" id="forgot-password-link">Forgot Password?</a></p>
                </div>
            </div>
            
            <div class="card" style="text-align: center; display: none;" id="signup-card">
                <h2 style="margin-bottom: 20px;">Create Account</h2>
                
                <div class="form-group">
                    <input type="email" class="form-input" id="signup-email" placeholder="Email address">
                </div>
                
                <div class="form-group">
                    <input type="password" class="form-input" id="signup-password" placeholder="Password">
                </div>
                
                <div class="form-group">
                    <input type="password" class="form-input" id="signup-confirm-password" placeholder="Confirm Password">
                </div>
                
                <div class="form-group">
                    <div style="display: flex; align-items: center;">
                        <label class="form-label">Referral Code</label>
                        <span class="optional-label">(optional)</span>
                    </div>
                    <input type="text" class="form-input" id="signup-referral-code" placeholder="Enter referral code if you have one">
                </div>
                
                <button class="btn" style="width: 100%; margin-bottom: 16px;" id="signup-btn">
                    <i class="fas fa-user-plus icon-sm" style="margin-right: 8px;"></i> Create Account
                </button>
                
                <p style="font-size: 14px;">By signing up, you agree to our <a href="#" style="color: var(--accent);">Terms of Service</a></p>
            </div>
            
            <div class="card" style="text-align: center; display: none;" id="forgot-password-card">
                <h2 style="margin-bottom: 20px;">Reset Password</h2>
                
                <div class="form-group">
                    <input type="email" class="form-input" id="reset-email" placeholder="Email address">
                </div>
                
                <button class="btn" style="width: 100%; margin-bottom: 16px;" id="reset-password-btn">
                    <i class="fas fa-paper-plane icon-sm" style="margin-right: 8px;"></i> Send Reset Link
                </button>
                
                <p style="font-size: 14px;"><a href="#" style="color: var(--accent); text-decoration: none;" id="back-to-login">Back to Login</a></p>
            </div>
        </div>

        <!-- Profile Completion Screen -->
        <div id="profile-screen" class="screen">
            <div class="app-header">
                <div class="logo gradient-text">Complete Profile</div>
            </div>
            
            <div class="card" style="text-align: center;">
                <div class="profile-avatar">
                    <i class="fas fa-user"></i>
                </div>
                <h2 style="margin-bottom: 20px;">Complete Your Profile</h2>
                <p style="margin-bottom: 24px; color: var(--text-secondary);">Please fill in your details to continue using Emirates Wealth Trading</p>
                
                <div class="form-group">
                    <label class="form-label required-field">Full Name</label>
                    <input type="text" class="form-input" id="profile-name" placeholder="Enter your full name">
                </div>
                
                <div class="form-group">
                    <label class="form-label required-field">Country</label>
                    <select class="form-input" id="profile-country">
                        <option value="">Select your country</option>
                        <option value="USA">United States</option>
                        <option value="UK">United Kingdom</option>
                        <option value="UAE">United Arab Emirates</option>
                        <option value="India">India</option>
                        <option value="Canada">Canada</option>
                        <option value="Australia">Australia</option>
                        <option value="Germany">Germany</option>
                        <option value="France">France</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label required-field">Phone Number</label>
                    <input type="tel" class="form-input" id="profile-phone" placeholder="Enter your phone number">
                </div>
                
                <div class="form-group">
                    <label class="form-label required-field">Binance ID</label>
                    <input type="text" class="form-input" id="profile-binance" placeholder="Enter your Binance ID">
                </div>
                
                <div class="form-group">
                    <label class="form-label required-field">TRC20 Wallet Address</label>
                    <input type="text" class="form-input" id="profile-trc20" placeholder="Enter your TRC20 wallet address">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Bank Account Details (Optional)</label>
                    <input type="text" class="form-input" id="profile-bank" placeholder="Bank name, account number, etc.">
                </div>
                
                <button class="btn" style="width: 100%;" id="save-profile-btn">
                    <i class="fas fa-save icon-sm" style="margin-right: 8px;"></i> Save Profile
                </button>
            </div>
        </div>

        <!-- Dashboard Screen -->
        <div id="dashboard-screen" class="screen">
            <div class="app-header">
                <div class="logo gradient-text">EWT</div>
                <div class="user-badge">
                    <span id="user-name">Guest</span>
                    <span class="vip-indicator" id="vip-badge" style="display: none;">‚≠ê</span>
                    <i class="fas fa-user-circle" id="profile-btn" style="cursor: pointer; margin-right: 8px;"></i>
                    <i class="fas fa-sign-out-alt" id="logout-btn" style="cursor: pointer;"></i>
                </div>
            </div>
            
            <div class="welcome-message" id="welcome-message">
                Welcome to Emirates Wealth Trading!
            </div>
            
            <div class="balance-display card">
                <p>Your Balance</p>
                <h2 class="balance-amount" id="user-balance">$0.00</h2>
                <div style="display: flex; justify-content: center; gap: 10px;">
                    <div style="background: rgba(0, 255, 153, 0.2); padding: 4px 12px; border-radius: 20px; font-size: 12px;">
                        <i class="fas fa-arrow-up"></i> +<span id="today-earnings">0.00</span> today
                    </div>
                    <div style="background: rgba(0, 206, 209, 0.2); padding: 4px 12px; border-radius: 20px; font-size: 12px;">
                        <i class="fas fa-users"></i> <span id="referral-count">0</span> referrals
                    </div>
                </div>
            </div>
            
            <div class="quick-actions">
                <div class="action-btn" id="deposit-btn">
                    <div class="action-icon"><i class="fas fa-arrow-down"></i></div>
                    <div class="action-label">Deposit</div>
                </div>
                <div class="action-btn" id="withdraw-btn">
                    <div class="action-icon"><i class="fas fa-arrow-up"></i></div>
                    <div class="action-label">Withdraw</div>
                </div>
                <div class="action-btn" id="packages-btn">
                    <div class="action-icon"><i class="fas fa-gift"></i></div>
                    <div class="action-label">Packages</div>
                </div>
                <div class="action-btn" id="referral-btn">
                    <div class="action-icon"><i class="fas fa-user-plus"></i></div>
                    <div class="action-label">Referral</div>
                </div>
            </div>
            
            <div class="scrolling-banner">
                <div class="banner-content">
                    üéâ Welcome to Emirates Wealth Trading! üéâ &nbsp;&nbsp;|&nbsp;&nbsp; üí∞ New VIP packages available! &nbsp;&nbsp;|&nbsp;&nbsp; üî• Refer friends and earn 10% commission! &nbsp;&nbsp;|&nbsp;&nbsp; ‚ö° Withdrawals processed within 2-5 minutes!
                </div>
            </div>
            
            <div class="card">
                <h3 style="margin-bottom: 16px;">Recent Transactions</h3>
                <div id="transactions-list">
                    <!-- Transactions will be populated by JavaScript -->
                </div>
            </div>
            
            <div class="card">
                <h3 style="margin-bottom: 16px;">VIP Purchases Feed</h3>
                <div style="height: 200px; overflow: hidden; position: relative;">
                    <div id="vip-feed" style="position: absolute; width: 100%;">
                        <!-- VIP feed items will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>

        <!-- VIP Packages Screen -->
        <div id="packages-screen" class="screen">
            <div class="app-header">
                <div class="logo gradient-text">VIP Packages</div>
                <div class="user-badge" id="back-to-dashboard-btn1" style="cursor: pointer;">
                    <i class="fas fa-arrow-left"></i> Back
                </div>
            </div>
            
            <div class="card">
                <p style="margin-bottom: 16px; font-size: 14px; color: var(--text-secondary);">VIP packages give daily compounded returns (auto-credited every 24h). Choose responsibly. Returns shown are simulated for demo.</p>
            </div>
            
            <div class="packages-container">
                
                
                <div class="package-card">
                    <div class="vip-badge">Premium</div>
                    <h3>VIP $100</h3>
                    <p style="font-size: 14px; color: var(--text-secondary); margin: 10px 0;">Daily returns: 6%</p>
                    <p style="font-size: 14px; margin-bottom: 20px;">Higher daily profit, 24h auto-credit</p>
                    <button class="btn vip-purchase-btn" style="width: 100%;" data-amount="100" data-percent="7">
                        <i class="fas fa-shopping-cart icon-sm" style="margin-right: 8px;"></i> Activate
                    </button>
                </div>
                
                <div class="package-card">
                    <div class="vip-badge">Advanced</div>
                    <h3>VIP $500</h3>
                    <p style="font-size: 14px; color: var(--text-secondary); margin: 10px 0;">Daily returns: 8%</p>
                    <p style="font-size: 14px; margin-bottom: 20px;">Priority support, 24h auto-credit</p>
                    <button class="btn vip-purchase-btn" style="width: 100%;" data-amount="500" data-percent="8">
                        <i class="fas fa-shopping-cart icon-sm" style="margin-right: 8px;"></i> Activate
                    </button>
                </div>
                
                <div class="package-card">
                    <div class="vip-badge">Professional</div>
                    <h3>VIP $700</h3>
                    <p style="font-size: 14px; color: var(--text-secondary); margin: 10px 0;">Daily returns: 9%</p>
                    <p style="font-size: 14px; margin-bottom: 20px;">24h auto-credit</p>
                    <button class="btn vip-purchase-btn" style="width: 100%;" data-amount="700" data-percent="9">
                        <i class="fas fa-shopping-cart icon-sm" style="margin-right: 8px;"></i> Activate
                    </button>
                </div>
                
                <div class="package-card">
                    <div class="vip-badge">Elite</div>
                    <h3>VIP $1000</h3>
                    <p style="font-size: 14px; color: var(--text-secondary); margin: 10px 0;">Daily returns: 10%</p>
                    <p style="font-size: 14px; margin-bottom: 20px;">24h auto-credit</p>
                    <button class="btn vip-purchase-btn" style="width: 100%;" data-amount="1000" data-percent="10">
                        <i class="fas fa-shopping-cart icon-sm" style="margin-right: 8px;"></i> Activate
                    </button>
                </div>
                
                <div class="package-card">
                    <div class="vip-badge">Premium Plus</div>
                    <h3>VIP $2000</h3>
                    <p style="font-size: 14px; color: var(--text-secondary); margin: 10px 0;">Daily returns: 11%</p>
                    <p style="font-size: 14px; margin-bottom: 20px;">24h auto-credit</p>
                    <button class="btn vip-purchase-btn" style="width: 100%;" data-amount="2000" data-percent="11">
                        <i class="fas fa-shopping-cart icon-sm" style="margin-right: 8px;"></i> Activate
                    </button>
                </div>
                
                <div class="package-card">
                    <div class="vip-badge">Executive</div>
                    <h3>VIP $5000</h3>
                    <p style="font-size: 14px; color: var(--text-secondary); margin: 10px 0;">Daily returns: 12%</p>
                    <p style="font-size: 14px; margin-bottom: 20px;">Executive benefits24h auto-credit</p>
                    <button class="btn vip-purchase-btn" style="width: 100%;" data-amount="5000" data-percent="12">
                        <i class="fas fa-shopping-cart icon-sm" style="margin-right: 8px;"></i> Activate
                    </button>
                </div>
                
                <div class="package-card locked">
                    <div class="vip-badge">Coming Soon</div>
                    <h3>VIP $10000</h3>
                    <p style="font-size: 14px; color: var(--text-secondary); margin: 10px 0;">Daily returns: 15%</p>
                    <p style="font-size: 14px; margin-bottom: 20px;">Ultimate VIP experience</p>
                    <button class="btn" style="width: 100%;" disabled>
                        <i class="fas fa-lock icon-sm" style="margin-right: 8px;"></i> Coming Soon
                    </button>
                </div>
            </div>
        </div>

        <!-- Deposit Screen -->
        <div id="deposit-screen" class="screen">
            <div class="app-header">
                <div class="logo gradient-text">Deposit Funds</div>
                <div class="user-badge" id="back-to-dashboard-btn2" style="cursor: pointer;">
                    <i class="fas fa-arrow-left"></i> Back
                </div>
            </div>
            
            <div class="card">
                <h3 style="margin-bottom: 16px;">Payment Addresses</h3>
                
                <div class="form-group">
                    <label class="form-label">TRC20 #1</label>
                    <div style="display: flex; align-items: center;">
                        <input type="text" class="form-input" value="TFXtR9SRtUFjxHTDUTW3MCah3um8qxDwFt" readonly>
                        <button class="btn" style="margin-left: 10px; padding: 10px;" onclick="copyToClipboard('TFXtR9SRtUFjxHTDUTW3MCah3um8qxDwFt')">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">TRC20 #2</label>
                    <div style="display: flex; align-items: center;">
                        <input type="text" class="form-input" value="TXoWzutmFoaXhr8g7KUoc3QXZegpQHzsfe" readonly>
                        <button class="btn" style="margin-left: 10px; padding: 10px;" onclick="copyToClipboard('TXoWzutmFoaXhr8g7KUoc3QXZegpQHzsfe')">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">ERC20</label>
                    <div style="display: flex; align-items: center;">
                        <input type="text" class="form-input" value="0xeB00d52BB61b059878930997a26b53722A62326c" readonly>
                        <button class="btn" style="margin-left: 10px; padding: 10px;" onclick="copyToClipboard('0xeB00d52BB61b059878930997a26b53722A62326c')">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h3 style="margin-bottom: 16px;">Deposit Amount</h3>
                
                <div class="form-group">
                    <input type="number" class="form-input" id="deposit-amount" placeholder="Enter amount">
                </div>
                
                <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                    <button class="btn" style="flex: 1;" onclick="setDepositAmount(100)">$100</button>
                    <button class="btn" style="flex: 1;" onclick="setDepositAmount(500)">$500</button>
                    <button class="btn" style="flex: 1;" onclick="setDepositAmount(1000)">$1000</button>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Upload Payment Proof</label>
                    <input type="file" accept="image/*" id="deposit-receipt" style="display: none;">
                    <button class="btn" style="width: 100%;" id="upload-receipt-btn">
                        <i class="fas fa-upload icon-sm" style="margin-right: 8px;"></i> Upload Receipt
                    </button>
                    <div id="receipt-preview" style="margin-top: 10px; display: none;">
                        <img src="" alt="Receipt preview" style="max-width: 100%; border-radius: 12px;">
                    </div>
                </div>
                
                <button class="btn" style="width: 100%;" id="submit-deposit-btn">
                    <i class="fas fa-paper-plane icon-sm" style="margin-right: 8px;"></i> Submit Deposit
                </button>
            </div>
        </div>

        <!-- Withdraw Screen -->
        <div id="withdraw-screen" class="screen">
            <div class="app-header">
                <div class="logo gradient-text">Withdraw Funds</div>
                <div class="user-badge" id="back-to-dashboard-btn3" style="cursor: pointer;">
                    <i class="fas fa-arrow-left"></i> Back
                </div>
            </div>
            
            <div class="card">
                <h3 style="margin-bottom: 16px;">Withdrawal Details</h3>
                
                <div class="form-group">
                    <input type="number" class="form-input" id="withdraw-amount" placeholder="Enter amount">
                </div>
                
                <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                    <button class="btn" style="flex: 1;" onclick="setWithdrawAmount(10)">$10</button>
                    <button class="btn" style="flex: 1;" onclick="setWithdrawAmount(50)">$50</button>
                    <button class="btn" style="flex: 1;" onclick="setWithdrawAmount(100)">$100</button>
                </div>
                
                <div class="form-group">
                    <label class="form-label">TRC20 Wallet Address</label>
                    <input type="text" class="form-input" id="withdraw-address" placeholder="Enter your TRC20 wallet address">
                </div>
                
                <button class="btn" style="width: 100%;" id="submit-withdraw-btn">
                    <i class="fas fa-paper-plane icon-sm" style="margin-right: 8px;"></i> Request Withdrawal
                </button>
            </div>
            
            <div class="card">
                <h3 style="margin-bottom: 16px;">Withdrawal Information</h3>
                <p style="font-size: 14px; color: var(--text-secondary); margin-bottom: 10px;">
                    <i class="fas fa-info-circle" style="color: var(--accent); margin-right: 8px;"></i>
                    Minimum withdrawal: $10
                </p>
                <p style="font-size: 14px; color: var(--text-secondary); margin-bottom: 10px;">
                    <i class="fas fa-clock" style="color: var(--accent); margin-right: 8px;"></i>
                    Processing time: 2-5 minutes
                </p>
                <p style="font-size: 14px; color: var(--text-secondary);">
                    <i class="fas fa-exclamation-triangle" style="color: var(--warning); margin-right: 8px;"></i>
                    Please double-check your wallet address
                </p>
            </div>
        </div>

        <!-- Code Verification Screen -->
        <div id="code-screen" class="screen">
            <div class="app-header">
                <div class="logo gradient-text" id="code-screen-title">Enter Code</div>
                <div class="user-badge" id="back-to-action-btn" style="cursor: pointer;">
                    <i class="fas fa-arrow-left"></i> Back
                </div>
            </div>
            
            <div class="card" style="text-align: center;">
                <h3 style="margin-bottom: 16px;" id="code-instruction">Enter 6-digit verification code</h3>
                <p style="margin-bottom: 20px; color: var(--text-secondary); font-size: 14px;" id="code-description">
                    Please enter the code provided by your agent
                </p>
                
                <div class="code-inputs">
                    <input type="text" class="code-input" maxlength="1" oninput="moveToNext(this)">
                    <input type="text" class="code-input" maxlength="1" oninput="moveToNext(this)">
                    <input type="text" class="code-input" maxlength="1" oninput="moveToNext(this)">
                    <input type="text" class="code-input" maxlength="1" oninput="moveToNext(this)">
                    <input type="text" class="code-input" maxlength="1" oninput="moveToNext(this)">
                    <input type="text" class="code-input" maxlength="1" oninput="checkCode(this)">
                </div>
                
                <button class="btn" style="width: 100%; margin-top: 20px;" id="verify-code-btn" disabled>
                    <i class="fas fa-check-circle icon-sm" style="margin-right: 8px;"></i> Verify Code
                </button>
            </div>
        </div>

        <!-- Referral Screen -->
        <div id="referral-screen" class="screen">
            <div class="app-header">
                <div class="logo gradient-text">Refer & Earn</div>
                <div class="user-badge" id="back-to-dashboard-btn4" style="cursor: pointer;">
                    <i class="fas fa-arrow-left"></i> Back
                </div>
            </div>
            
            <div class="card">
                <h3 style="margin-bottom: 16px;">Your Referral Code</h3>
                
                <div class="referral-code">
                    <span id="user-referral-code">EWT-XXXXXX</span>
                    <button class="btn" style="padding: 8px 12px;" onclick="copyReferralCode()">
                        <i class="fas fa-copy"></i>
                    </button>
                </div>
                
                <p style="font-size: 14px; color: var(--text-secondary); margin-bottom: 16px;">
                    Share your code with friends and earn 10% commission on their first deposit!
                </p>
            </div>
            
            <div class="card">
                <h3 style="margin-bottom: 16px;">Referral Earnings</h3>
                
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <div>Total Earnings:</div>
                    <div class="transaction-positive">$<span id="total-earnings">0.00</span></div>
                </div>
                
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <div>Pending:</div>
                    <div class="transaction-positive">$<span id="pending-earnings">0.00</span></div>
                </div>
                
                <div style="display: flex; justify-content: space-between;">
                    <div>Available:</div>
                    <div class="transaction-positive">$<span id="available-earnings">0.00</span></div>
                </div>
                
                <button class="btn" style="width: 100%; margin-top: 15px;" id="withdraw-referral-btn">
                    <i class="fas fa-money-bill-wave icon-sm" style="margin-right: 8px;"></i> Withdraw Referral Earnings
                </button>
            </div>
            
            <div class="card">
                <h3 style="margin-bottom: 16px;">Your Referrals</h3>
                <div id="referrals-list">
                    <div style="text-align: center; padding: 20px; color: var(--text-secondary);">
                        <i class="fas fa-users" style="font-size: 32px; margin-bottom: 10px;"></i>
                        <p>No referrals yet</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- About Screen -->
        <div id="about-screen" class="screen">
            <div class="app-header">
                <div class="logo gradient-text">About Us</div>
                <div class="user-badge" id="back-to-dashboard-btn5" style="cursor: pointer;">
                    <i class="fas fa-arrow-left"></i> Back
                </div>
            </div>
            
            <div class="card">
                <h3 style="margin-bottom: 16px;">Emirates Wealth Trading</h3>
                <p style="margin-bottom: 16px; color: var(--text-secondary);">
                    Emirates Wealth Trading is a premier investment platform offering exclusive VIP packages with daily returns. 
                    Our mission is to provide our clients with secure and profitable investment opportunities in the crypto space.
                </p>
                
                <h4 style="margin-bottom: 12px;">Our Services</h4>
                <ul style="color: var(--text-secondary); padding-left: 20px; margin-bottom: 16px;">
                    <li>VIP Investment Packages</li>
                    <li>Daily Compounded Returns</li>
                    <li>Secure Crypto Transactions</li>
                    <li>24/7 Customer Support</li>
                    <li>Referral Program</li>
                </ul>
            </div>
            
            <div class="card">
                <h3 style="margin-bottom: 16px;">Contact Us</h3>
                
                <div class="contact-item" onclick="window.open('https://t.me/emirates_wealth_2', '_blank')">
                    <div class="contact-icon">
                        <i class="fab fa-telegram"></i>
                    </div>
                    <div>
                        <div>Telegram</div>
                        <div style="font-size: 12px; color: var(--text-secondary);">@emirates_wealth_2</div>
                    </div>
                </div>
                
                <div class="contact-item" onclick="window.open('https://wa.me/441529518717', '_blank')">
                    <div class="contact-icon">
                        <i class="fab fa-whatsapp"></i>
                    </div>
                    <div>
                        <div>WhatsApp</div>
                        <div style="font-size: 12px; color: var(--text-secondary);">+44 1529 518717</div>
                    </div>
                </div>
                
                <div class="contact-item" onclick="window.open('mailto:support@emirateswealth.com', '_blank')">
                    <div class="contact-icon">
                        <i class="fas fa-envelope"></i>
                    </div>
                    <div>
                        <div>Email</div>
                        <div style="font-size: 12px; color: var(--text-secondary);">support@emirateswealth.com</div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h3 style="margin-bottom: 16px;">Payment Addresses</h3>
                
                <div class="form-group">
                    <label class="form-label">TRC20 #1</label>
                    <div style="display: flex; align-items: center;">
                        <input type="text" class="form-input" value="TFXtR9SRtUFjxHTDUTW3MCah3um8qxDwFt" readonly>
                        <button class="btn" style="margin-left: 10px; padding: 10px;" onclick="copyToClipboard('TFXtR9SRtUFjxHTDUTW3MCah3um8qxDwFt')">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">TRC20 #2</label>
                    <div style="display: flex; align-items: center;">
                        <input type="text" class="form-input" value="TXoWzutmFoaXhr8g7KUoc3QXZegpQHzsfe" readonly>
                        <button class="btn" style="margin-left: 10px; padding: 10px;" onclick="copyToClipboard('TXoWzutmFoaXhr8g7KUoc3QXZegpQHzsfe')">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">ERC20</label>
                    <div style="display: flex; align-items: center;">
                        <input type="text" class="form-input" value="0xeB00d52BB61b059878930997a26b53722A62326c" readonly>
                        <button class="btn" style="margin-left: 10px; padding: 10px;" onclick="copyToClipboard('0xeB00d52BB61b059878930997a26b53722A62326c')">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <div class="bottom-nav">
            <div class="nav-item active" data-screen="dashboard-screen">
                <div class="nav-icon"><i class="fas fa-home"></i></div>
                <div class="nav-label">Dashboard</div>
            </div>
            <div class="nav-item" data-screen="packages-screen">
                <div class="nav-icon"><i class="fas fa-crown"></i></div>
                <div class="nav-label">VIP</div>
            </div>
            <div class="nav-item" data-screen="deposit-screen">
                <div class="nav-icon"><i class="fas fa-wallet"></i></div>
                <div class="nav-label">Deposit</div>
            </div>
            <div class="nav-item" data-screen="referral-screen">
                <div class="nav-icon"><i class="fas fa-user-friends"></i></div>
                <div class="nav-label">Referral</div>
            </div>
            <div class="nav-item" data-screen="about-screen">
                <div class="nav-icon"><i class="fas fa-info-circle"></i></div>
                <div class="nav-label">About</div>
            </div>
        </div>
    </div>

    <script>
        // Initialize localStorage data
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize deposit codes
            if (!localStorage.getItem('EWT_depositCodes')) {
                const depositCodes = [
                    "823741", "912346", "556203", "174932", "695208", "312478", "478256", "230695", "867401", "359284",
                    "784512", "146907", "903856", "258147", "678940", "410932", "512783", "307845", "926451", "198754",
                    "509863", "472186", "345981", "782619", "169347", "806421", "930572", "251697", "627849", "593210",
                    "412896", "589473", "761932", "143298", "378215", "290463", "894376", "612359", "473905", "853217",
                    "269540", "130958", "592831", "740185", "869203", "913425", "541980", "438592", "796210", "285319"
                ].map(code => ({ code, used: false }));
                localStorage.setItem('EWT_depositCodes', JSON.stringify(depositCodes));
            }
            
            // Initialize withdraw codes
            if (!localStorage.getItem('EWT_withdrawCodes')) {
                const withdrawCodes = [
                    "291847", "508296", "374980", "862149", "730592", "918540", "182649", "475930", "623807", "905128",
                    "736210", "820194", "359281", "604859", "248197", "105924", "930658", "459712", "783104", "821390",
                    "209347", "475839", "692813", "519204", "804325", "658419", "913028", "742158", "621893", "859431",
                    "139582", "296450", "485903", "925801", "658203", "593801", "819573", "720459", "385291", "496185",
                    "820591", "164930", "582039", "340198", "819460", "790832", "402985", "502198", "218947", "692048"
                ].map(code => ({ code, used: false }));
                localStorage.setItem('EWT_withdrawCodes', JSON.stringify(withdrawCodes));
            }
            
            // Initialize VIP feed samples
            if (!localStorage.getItem('EWT_vipFeedSamples')) {
                const usernames = ["CryptoKing", "BitcoinBull", "WealthBuilder", "TradeMaster", "CryptoQueen", "InvestorPro", "CryptoWhale", "MoneyMaker", "ProfitSeeker", "EliteTrader"];
                const packages = ["VIP $50 ‚Äî Solo", "VIP $100", "VIP $300", "VIP $500", "VIP $1000", "VIP $2000", "VIP $5000"];
                const times = ["just now", "1 min ago", "2 mins ago", "5 mins ago", "10 mins ago", "15 mins ago", "30 mins ago"];
                
                const vipFeedSamples = [];
                for (let i = 0; i < 100; i++) {
                    vipFeedSamples.push({
                        username: usernames[Math.floor(Math.random() * usernames.length)],
                        package: packages[Math.floor(Math.random() * packages.length)],
                        time: times[Math.floor(Math.random() * times.length)]
                    });
                }
                localStorage.setItem('EWT_vipFeedSamples', JSON.stringify(vipFeedSamples));
            }
            
            // Initialize users array if not exists
            if (!localStorage.getItem('EWT_users')) {
                localStorage.setItem('EWT_users', JSON.stringify([]));
            }
            
            // Check if user is logged in
            const currentUser = JSON.parse(localStorage.getItem('EWT_currentUser') || 'null');
            if (currentUser) {
                // Check if profile is completed
                if (!currentUser.profileCompleted) {
                    showScreen('profile-screen');
                } else {
                    showScreen('dashboard-screen');
                    updateDashboard(currentUser);
                    startEarningsCalculation(currentUser);
                }
            } else {
                showScreen('auth-screen');
            }
            
            // Initialize VIP feed
            initializeVIPFeed();
            
            // Add event listeners for VIP package purchases
            document.querySelectorAll('.vip-purchase-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const amount = parseFloat(this.getAttribute('data-amount'));
                    const percent = parseFloat(this.getAttribute('data-percent'));
                    purchaseVIPPackage(amount, percent);
                });
            });
            
            // Add event listener for referral earnings withdrawal
            document.getElementById('withdraw-referral-btn').addEventListener('click', function() {
                withdrawReferralEarnings();
            });
            
            // Add event listener for password reset
            document.getElementById('reset-password-btn').addEventListener('click', function() {
                resetPassword();
            });
        });

        // Screen management
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
            
            // Update bottom nav
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            const navItem = document.querySelector(`.nav-item[data-screen="${screenId}"]`);
            if (navItem) {
                navItem.classList.add('active');
            }
            
            // Update referral screen if it's the active screen
            if (screenId === 'referral-screen') {
                const currentUser = JSON.parse(localStorage.getItem('EWT_currentUser'));
                if (currentUser) {
                    updateReferralScreen(currentUser);
                }
            }
        }

        // Bottom navigation
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', function() {
                const screenId = this.getAttribute('data-screen');
                if (screenId) {
                    showScreen(screenId);
                }
            });
        });

        // Auth screen interactions
        document.getElementById('signup-link').addEventListener('click', function(e) {
            e.preventDefault();
            document.getElementById('signup-card').style.display = 'block';
            document.getElementById('forgot-password-card').style.display = 'none';
        });

        document.getElementById('forgot-password-link').addEventListener('click', function(e) {
            e.preventDefault();
            document.getElementById('forgot-password-card').style.display = 'block';
            document.getElementById('signup-card').style.display = 'none';
        });

        document.getElementById('back-to-login').addEventListener('click', function(e) {
            e.preventDefault();
            document.getElementById('forgot-password-card').style.display = 'none';
            document.getElementById('signup-card').style.display = 'none';
        });

        // Login functionality
        document.getElementById('login-btn').addEventListener('click', function() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            if (!email || !password) {
                showToast('Please enter both email and password', 'error');
                return;
            }
            
            const users = JSON.parse(localStorage.getItem('EWT_users') || '[]');
            const user = users.find(u => u.email === email && u.password === password);
            
            if (user) {
                localStorage.setItem('EWT_currentUser', JSON.stringify(user));
                
                // Check if profile is completed
                if (!user.profileCompleted) {
                    showScreen('profile-screen');
                } else {
                    showScreen('dashboard-screen');
                    updateDashboard(user);
                    startEarningsCalculation(user);
                    showToast('Login successful!', 'success');
                }
            } else {
                showToast('Invalid email or password', 'error');
            }
        });

        // Signup functionality
        document.getElementById('signup-btn').addEventListener('click', function() {
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            const confirmPassword = document.getElementById('signup-confirm-password').value;
            const referralCode = document.getElementById('signup-referral-code').value;
            
            if (!email || !password || !confirmPassword) {
                showToast('Please fill all required fields', 'error');
                return;
            }
            
            if (password !== confirmPassword) {
                showToast('Passwords do not match', 'error');
                return;
            }
            
            if (password.length < 6) {
                showToast('Password must be at least 6 characters', 'error');
                return;
            }
            
            const users = JSON.parse(localStorage.getItem('EWT_users') || '[]');
            
            if (users.some(u => u.email === email)) {
                showToast('Email already registered', 'error');
                return;
            }
            
            // Generate unique referral code for the new user
            const userReferralCode = generateReferralCode();
            
            const newUser = {
                id: Date.now().toString(),
                email,
                password,
                balance: 5, // $5 welcome bonus
                referralEarnings: {
                    total: 0,
                    available: 0,
                    withdrawn: 0
                },
                vipLevel: 0,
                vipPackages: [],
                referralCode: userReferralCode,
                referredBy: referralCode || null,
                referrals: [],
                transactions: [
                    {
                        id: Date.now().toString(),
                        type: 'bonus',
                        amount: 5,
                        status: 'completed',
                        createdAt: new Date().toISOString(),
                        description: 'Welcome bonus'
                    }
                ],
                profileCompleted: false,
                profile: {}
            };
            
            users.push(newUser);
            localStorage.setItem('EWT_users', JSON.stringify(users));
            localStorage.setItem('EWT_currentUser', JSON.stringify(newUser));
            
            // If user was referred by someone, update the referrer's account
            if (referralCode) {
                const referrer = users.find(u => u.referralCode === referralCode);
                if (referrer) {
                    referrer.referrals.push({
                        id: newUser.id,
                        email: email,
                        date: new Date().toISOString(),
                        earned: 0,
                        status: 'pending'
                    });
                    
                    // Update referrer in localStorage
                    localStorage.setItem('EWT_users', JSON.stringify(users));
                }
            }
            
            showScreen('profile-screen');
            showToast('Account created! Please complete your profile.', 'success');
        });

        // Password reset functionality
        function resetPassword() {
            const email = document.getElementById('reset-email').value;
            
            if (!email) {
                showToast('Please enter your email address', 'error');
                return;
            }
            
            const users = JSON.parse(localStorage.getItem('EWT_users') || '[]');
            const user = users.find(u => u.email === email);
            
            if (!user) {
                showToast('No account found with this email', 'error');
                return;
            }
            
            // In a real application, you would send a reset link to the email
            // For this demo, we'll just show a success message
            showToast('Password reset instructions sent to your email', 'success');
            
            // Reset the form and go back to login
            document.getElementById('reset-email').value = '';
            document.getElementById('forgot-password-card').style.display = 'none';
        }

        // Generate unique referral code
        function generateReferralCode() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let code = '';
            for (let i = 0; i < 8; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return 'EWT-' + code;
        }

        // Save profile functionality
        document.getElementById('save-profile-btn').addEventListener('click', function() {
            const name = document.getElementById('profile-name').value;
            const country = document.getElementById('profile-country').value;
            const phone = document.getElementById('profile-phone').value;
            const binanceId = document.getElementById('profile-binance').value;
            const trc20Address = document.getElementById('profile-trc20').value;
            const bankDetails = document.getElementById('profile-bank').value;
            
            if (!name || !country || !phone || !binanceId || !trc20Address) {
                showToast('Please fill all required fields', 'error');
                return;
            }
            
            const currentUser = JSON.parse(localStorage.getItem('EWT_currentUser'));
            const users = JSON.parse(localStorage.getItem('EWT_users'));
            
            // Update user profile
            currentUser.name = name;
            currentUser.profile = {
                country,
                phone,
                binanceId,
                trc20Address,
                bankDetails
            };
            currentUser.profileCompleted = true;
            
            // Update user in users array
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            if (userIndex !== -1) {
                users[userIndex] = currentUser;
            }
            
            localStorage.setItem('EWT_users', JSON.stringify(users));
            localStorage.setItem('EWT_currentUser', JSON.stringify(currentUser));
            
            showScreen('dashboard-screen');
            updateDashboard(currentUser);
            showToast('Profile saved successfully!', 'success');
        });

        // Gmail and Facebook auth buttons
        document.getElementById('gmail-btn').addEventListener('click', function() {
            const email = prompt('Enter your Gmail address:');
            if (email && email.endsWith('@gmail.com')) {
                showToast('Gmail authentication successful', 'success');
            } else if (email) {
                showToast('Only @gmail.com addresses are allowed', 'error');
            }
        });

        document.getElementById('facebook-btn').addEventListener('click', function() {
            showToast('Facebook authentication not implemented in demo', 'error');
        });

        // Dashboard navigation
        document.getElementById('deposit-btn').addEventListener('click', function() {
            showScreen('deposit-screen');
        });

        document.getElementById('withdraw-btn').addEventListener('click', function() {
            showScreen('withdraw-screen');
        });

        document.getElementById('packages-btn').addEventListener('click', function() {
            showScreen('packages-screen');
        });

        document.getElementById('referral-btn').addEventListener('click', function() {
            showScreen('referral-screen');
        });

        // Profile button
        document.getElementById('profile-btn').addEventListener('click', function() {
            showScreen('profile-screen');
        });

        // Back buttons
        document.getElementById('back-to-dashboard-btn1').addEventListener('click', function() {
            showScreen('dashboard-screen');
        });

        document.getElementById('back-to-dashboard-btn2').addEventListener('click', function() {
            showScreen('dashboard-screen');
        });

        document.getElementById('back-to-dashboard-btn3').addEventListener('click', function() {
            showScreen('dashboard-screen');
        });

        document.getElementById('back-to-dashboard-btn4').addEventListener('click', function() {
            showScreen('dashboard-screen');
        });

        document.getElementById('back-to-dashboard-btn5').addEventListener('click', function() {
            showScreen('dashboard-screen');
        });

        document.getElementById('back-to-action-btn').addEventListener('click', function() {
            const codeType = document.getElementById('verify-code-btn').getAttribute('data-type');
            if (codeType === 'deposit') {
                showScreen('deposit-screen');
            } else if (codeType === 'withdraw') {
                showScreen('withdraw-screen');
            }
        });

        // Logout button
        document.getElementById('logout-btn').addEventListener('click', function() {
            localStorage.removeItem('EWT_currentUser');
            showScreen('auth-screen');
            showToast('Logged out successfully', 'success');
        });

        // Update dashboard with user data
        function updateDashboard(user) {
            document.getElementById('user-name').textContent = user.name || user.email;
            document.getElementById('user-balance').textContent = `$${(user.balance + (user.referralEarnings?.available || 0)).toFixed(2)}`;
            
            // Update welcome message
            document.getElementById('welcome-message').textContent = user.name ? 
                `Welcome back, ${user.name}!` : `Welcome to Emirates Wealth Trading!`;
            
            // Calculate today's earnings (simulated)
            const todayEarnings = user.vipPackages ? user.vipPackages.reduce((total, pkg) => total + (pkg.amount * pkg.percent / 100), 0) : 0;
            document.getElementById('today-earnings').textContent = todayEarnings.toFixed(2);
            
            // Show referral count
            document.getElementById('referral-count').textContent = user.referrals?.length || '0';
            
            // Show VIP badge if user has VIP level
            document.getElementById('vip-badge').style.display = user.vipLevel > 0 ? 'inline' : 'none';
            
            // Update transactions list
            const transactionsList = document.getElementById('transactions-list');
            transactionsList.innerHTML = '';
            
            if (user.transactions && user.transactions.length > 0) {
                const recentTransactions = user.transactions.slice(-5).reverse();
                
                recentTransactions.forEach(transaction => {
                    const item = document.createElement('div');
                    item.className = 'transaction-item';
                    
                    const icon = document.createElement('div');
                    icon.className = 'transaction-icon';
                    
                    if (transaction.type === 'deposit') {
                        icon.innerHTML = '<i class="fas fa-arrow-down"></i>';
                    } else if (transaction.type === 'withdraw') {
                        icon.innerHTML = '<i class="fas fa-arrow-up"></i>';
                    } else if (transaction.type === 'vip') {
                        icon.innerHTML = '<i class="fas fa-crown"></i>';
                    } else if (transaction.type === 'referral') {
                        icon.innerHTML = '<i class="fas fa-user-friends"></i>';
                    } else {
                        icon.innerHTML = '<i class="fas fa-gift"></i>';
                    }
                    
                    const details = document.createElement('div');
                    details.className = 'transaction-details';
                    
                    const type = document.createElement('div');
                    type.textContent = transaction.description || transaction.type;
                    
                    const time = document.createElement('div');
                    time.style.fontSize = '12px';
                    time.style.color = 'var(--text-secondary)';
                    time.textContent = formatTime(transaction.createdAt);
                    
                    details.appendChild(type);
                    details.appendChild(time);
                    
                    const amount = document.createElement('div');
                    amount.className = `transaction-amount transaction-${transaction.type === 'deposit' || transaction.type === 'bonus' || transaction.type === 'vip' || transaction.type === 'referral' ? 'positive' : 'negative'}`;
                    amount.textContent = `${transaction.type === 'deposit' || transaction.type === 'bonus' || transaction.type === 'vip' || transaction.type === 'referral' ? '+' : '-'}$${transaction.amount.toFixed(2)}`;
                    
                    item.appendChild(icon);
                    item.appendChild(details);
                    item.appendChild(amount);
                    
                    transactionsList.appendChild(item);
                });
            } else {
                transactionsList.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: var(--text-secondary);">
                        <i class="fas fa-exchange-alt" style="font-size: 32px; margin-bottom: 10px;"></i>
                        <p>No transactions yet</p>
                    </div>
                `;
            }
            
            // Update referral screen if it's the active screen
            if (document.getElementById('referral-screen').classList.contains('active')) {
                updateReferralScreen(user);
            }
        }

        // Update referral screen with user data
        function updateReferralScreen(user) {
            document.getElementById('user-referral-code').textContent = user.referralCode;
            
            // Calculate referral earnings
            const totalEarnings = user.referralEarnings?.total || 0;
            const availableEarnings = user.referralEarnings?.available || 0;
            const withdrawnEarnings = user.referralEarnings?.withdrawn || 0;
            
            document.getElementById('total-earnings').textContent = totalEarnings.toFixed(2);
            document.getElementById('available-earnings').textContent = availableEarnings.toFixed(2);
            document.getElementById('pending-earnings').textContent = (totalEarnings - availableEarnings - withdrawnEarnings).toFixed(2);
            
            // Update referrals list
            const referralsList = document.getElementById('referrals-list');
            referralsList.innerHTML = '';
            
            if (user.referrals && user.referrals.length > 0) {
                user.referrals.forEach(referral => {
                    const referralItem = document.createElement('div');
                    referralItem.className = 'transaction-item';
                    
                    const icon = document.createElement('div');
                    icon.className = 'transaction-icon';
                    icon.innerHTML = '<i class="fas fa-user"></i>';
                    
                    const details = document.createElement('div');
                    details.className = 'transaction-details';
                    
                    const email = document.createElement('div');
                    email.textContent = referral.email;
                    
                    const status = document.createElement('div');
                    status.style.fontSize = '12px';
                    status.style.color = 'var(--text-secondary)';
                    status.textContent = `Status: ${referral.status} | Earned: $${referral.earned.toFixed(2)}`;
                    
                    details.appendChild(email);
                    details.appendChild(status);
                    
                    referralItem.appendChild(icon);
                    referralItem.appendChild(details);
                    
                    referralsList.appendChild(referralItem);
                });
            } else {
                referralsList.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: var(--text-secondary);">
                        <i class="fas fa-users" style="font-size: 32px; margin-bottom: 10px;"></i>
                        <p>No referrals yet</p>
                    </div>
                `;
            }
        }

        // Format time for display
        function formatTime(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);
            
            if (diffMins < 1) return 'just now';
            if (diffMins < 60) return `${diffMins} min${diffMins > 1 ? 's' : ''} ago`;
            if (diffHours < 24) return `${diffHours} hour${diffHours > 1 ? 's' : ''} ago`;
            if (diffDays < 7) return `${diffDays} day${diffDays > 1 ? 's' : ''} ago`;
            
            return date.toLocaleDateString();
        }

        // Initialize VIP feed
        function initializeVIPFeed() {
            const vipFeedSamples = JSON.parse(localStorage.getItem('EWT_vipFeedSamples'));
            const vipFeed = document.getElementById('vip-feed');
            
            vipFeed.innerHTML = '';
            
            vipFeedSamples.forEach((item, index) => {
                const feedItem = document.createElement('div');
                feedItem.className = 'transaction-item';
                feedItem.style.opacity = 1 - (index * 0.01);
                
                const icon = document.createElement('div');
                icon.className = 'transaction-icon';
                icon.innerHTML = '<i class="fas fa-crown"></i>';
                
                const details = document.createElement('div');
                details.className = 'transaction-details';
                
                const text = document.createElement('div');
                text.textContent = `${item.username} purchased ${item.package}`;
                
                const time = document.createElement('div');
                time.style.fontSize = '12px';
                time.style.color = 'var(--text-secondary)';
                time.textContent = item.time;
                
                details.appendChild(text);
                details.appendChild(time);
                
                feedItem.appendChild(icon);
                feedItem.appendChild(details);
                
                vipFeed.appendChild(feedItem);
            });
            
            // Animate the feed
            let position = 0;
            setInterval(() => {
                position -= 1;
                if (position < -vipFeed.offsetHeight) {
                    position = 0;
                }
                vipFeed.style.transform = `translateY(${position}px)`;
            }, 50);
        }

        // Show toast notification
        function showToast(message, type) {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <span>${type === 'success' ? '<i class="fas fa-check-circle"></i>' : '<i class="fas fa-exclamation-circle"></i>'}</span>
                <span>${message}</span>
            `;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transition = 'opacity 0.5s';
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 500);
            }, 3000);
        }

        // Deposit screen functionality
        document.getElementById('upload-receipt-btn').addEventListener('click', function() {
            document.getElementById('deposit-receipt').click();
        });

        document.getElementById('deposit-receipt').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = FileReader ? new FileReader() : new ActiveXObject('Microsoft.XMLHTTP');
                reader.onload = function(event) {
                    const preview = document.getElementById('receipt-preview');
                    preview.style.display = 'block';
                    preview.querySelector('img').src = event.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        function setDepositAmount(amount) {
            document.getElementById('deposit-amount').value = amount;
        }

        document.getElementById('submit-deposit-btn').addEventListener('click', function() {
            const amount = parseFloat(document.getElementById('deposit-amount').value);
            const receipt = document.getElementById('deposit-receipt').files[0];
            
            if (!amount || amount <= 0) {
                showToast('Please enter a valid amount', 'error');
                return;
            }
            
            if (!receipt) {
                showToast('Please upload payment proof', 'error');
                return;
            }
            
            // Show code verification screen
            document.getElementById('code-screen-title').textContent = 'Deposit Verification';
            document.getElementById('code-instruction').textContent = 'Enter 6-digit deposit code';
            document.getElementById('code-description').textContent = 'Please enter the code provided by your agent';
            document.getElementById('verify-code-btn').setAttribute('data-type', 'deposit');
            document.getElementById('verify-code-btn').setAttribute('data-amount', amount);
            
            // Clear code inputs
            document.querySelectorAll('.code-input').forEach(input => {
                input.value = '';
            });
            
            showScreen('code-screen');
        });

        // Withdraw screen functionality
        function setWithdrawAmount(amount) {
            document.getElementById('withdraw-amount').value = amount;
        }

        document.getElementById('submit-withdraw-btn').addEventListener('click', function() {
            const amount = parseFloat(document.getElementById('withdraw-amount').value);
            const address = document.getElementById('withdraw-address').value;
            
            if (!amount || amount <= 0) {
                showToast('Please enter a valid amount', 'error');
                return;
            }
            
            if (amount < 10) {
                showToast('Minimum withdrawal is $10', 'error');
                return;
            }
            
            if (!address) {
                showToast('Please enter your wallet address', 'error');
                return;
            }
            
            const currentUser = JSON.parse(localStorage.getItem('EWT_currentUser'));
            const totalBalance = currentUser.balance + (currentUser.referralEarnings?.available || 0);
            
            if (amount > totalBalance) {
                showToast('Insufficient balance', 'error');
                return;
            }
            
            // Show code verification screen
            document.getElementById('code-screen-title').textContent = 'Withdrawal Verification';
            document.getElementById('code-instruction').textContent = 'Enter 6-digit withdrawal code';
            document.getElementById('code-description').textContent = 'Please enter the code provided by your agent';
            document.getElementById('verify-code-btn').setAttribute('data-type', 'withdraw');
            document.getElementById('verify-code-btn').setAttribute('data-amount', amount);
            document.getElementById('verify-code-btn').setAttribute('data-address', address);
            
            // Clear code inputs
            document.querySelectorAll('.code-input').forEach(input => {
                input.value = '';
            });
            
            showScreen('code-screen');
        });

        // VIP Package purchase functionality
        function purchaseVIPPackage(amount, percent) {
            const currentUser = JSON.parse(localStorage.getItem('EWT_currentUser'));
            const totalBalance = currentUser.balance + (currentUser.referralEarnings?.available || 0);
            
            if (totalBalance < amount) {
                showToast('Insufficient balance to purchase this VIP package', 'error');
                return;
            }
            
            // Update user balance - use referral earnings first, then main balance
            const users = JSON.parse(localStorage.getItem('EWT_users'));
            
            let remainingAmount = amount;
            if (currentUser.referralEarnings?.available > 0) {
                const referralUsed = Math.min(currentUser.referralEarnings.available, remainingAmount);
                currentUser.referralEarnings.available -= referralUsed;
                remainingAmount -= referralUsed;
            }
            
            if (remainingAmount > 0) {
                currentUser.balance -= remainingAmount;
            }
            
            currentUser.vipLevel = Math.max(currentUser.vipLevel, 1);
            
            // Add VIP package
            if (!currentUser.vipPackages) {
                currentUser.vipPackages = [];
            }
            
            currentUser.vipPackages.push({
                amount: amount,
                percent: percent,
                purchaseDate: new Date().toISOString(),
                lifetime: true
            });
            
            currentUser.transactions.push({
                id: Date.now().toString(),
                type: 'vip',
                amount: amount,
                status: 'completed',
                createdAt: new Date().toISOString(),
                description: `VIP $${amount} Package Purchase`
            });
            
            // Update user in users array
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            if (userIndex !== -1) {
                users[userIndex] = currentUser;
            }
            
            localStorage.setItem('EWT_users', JSON.stringify(users));
            localStorage.setItem('EWT_currentUser', JSON.stringify(currentUser));
            
            updateDashboard(currentUser);
            showToast(`VIP $${amount} package purchased successfully!`, 'success');
            
            // Start earnings calculation if not already started
            startEarningsCalculation(currentUser);
        }

        // Start calculating earnings from VIP packages
        function startEarningsCalculation(user) {
            if (!user.vipPackages || user.vipPackages.length === 0) return;
            
            // Calculate total daily earnings
            const dailyEarnings = user.vipPackages.reduce((total, pkg) => {
                return total + (pkg.amount * pkg.percent / 100);
            }, 0);
            
            // Update earnings every 10 seconds for demo purposes (would be 24 hours in real app)
            if (!window.earningsInterval) {
                window.earningsInterval = setInterval(() => {
                    const currentUser = JSON.parse(localStorage.getItem('EWT_currentUser'));
                    const users = JSON.parse(localStorage.getItem('EWT_users'));
                    
                    // Add earnings to balance
                    currentUser.balance += dailyEarnings / 8640; // Divided to show gradual increase
                    
                    // Update user in users array
                    const userIndex = users.findIndex(u => u.id === currentUser.id);
                    if (userIndex !== -1) {
                        users[userIndex] = currentUser;
                    }
                    
                    localStorage.setItem('EWT_users', JSON.stringify(users));
                    localStorage.setItem('EWT_currentUser', JSON.stringify(currentUser));
                    
                    updateDashboard(currentUser);
                }, 10000); // Update every 10 seconds for demo
            }
        }

        // Code input functionality
        function moveToNext(input) {
            if (input.value.length === 1) {
                const next = input.nextElementSibling;
                if (next && next.classList.contains('code-input')) {
                    next.focus();
                }
            }
            checkAllFilled();
        }

        function checkCode(input) {
            if (input.value.length === 1) {
                checkAllFilled();
            }
        }

        function checkAllFilled() {
            const inputs = document.querySelectorAll('.code-input');
            const allFilled = Array.from(inputs).every(input => input.value.length === 1);
            document.getElementById('verify-code-btn').disabled = !allFilled;
        }

        document.getElementById('verify-code-btn').addEventListener('click', function() {
            const inputs = document.querySelectorAll('.code-input');
            const code = Array.from(inputs).map(input => input.value).join('');
            const type = this.getAttribute('data-type');
            const amount = parseFloat(this.getAttribute('data-amount'));
            
            if (type === 'deposit') {
                verifyDepositCode(code, amount);
            } else if (type === 'withdraw') {
                const address = this.getAttribute('data-address');
                verifyWithdrawCode(code, amount, address);
            }
        });

        function verifyDepositCode(code, amount) {
            const depositCodes = JSON.parse(localStorage.getItem('EWT_depositCodes'));
            const codeIndex = depositCodes.findIndex(c => c.code === code && !c.used);
            
            if (codeIndex === -1) {
                showToast('Invalid or already used code', 'error');
                document.querySelector('.code-inputs').classList.add('shake');
                setTimeout(() => {
                    document.querySelector('.code-inputs').classList.remove('shake');
                }, 500);
                return;
            }
            
            // Mark code as used
            depositCodes[codeIndex].used = true;
            localStorage.setItem('EWT_depositCodes', JSON.stringify(depositCodes));
            
            // Update user balance
            const currentUser = JSON.parse(localStorage.getItem('EWT_currentUser'));
            const users = JSON.parse(localStorage.getItem('EWT_users'));
            
            currentUser.balance += amount;
            currentUser.transactions.push({
                id: Date.now().toString(),
                type: 'deposit',
                amount,
                status: 'pending',
                createdAt: new Date().toISOString(),
                description: 'Deposit'
            });
            
            // If user was referred by someone, add referral commission
            if (currentUser.referredBy) {
                const referrer = users.find(u => u.referralCode === currentUser.referredBy);
                if (referrer) {
                    const commission = amount * 0.1; // 10% commission
                    
                    // Initialize referral earnings if not exists
                    if (!referrer.referralEarnings) {
                        referrer.referralEarnings = {
                            total: 0,
                            available: 0,
                            withdrawn: 0
                        };
                    }
                    
                    referrer.referralEarnings.total += commission;
                    
                    // Find the referral and update it
                    const referralIndex = referrer.referrals.findIndex(r => r.id === currentUser.id);
                    if (referralIndex !== -1) {
                        referrer.referrals[referralIndex].earned += commission;
                        referrer.referrals[referralIndex].status = 'active';
                    }
                    
                    // Add transaction for referrer
                    referrer.transactions.push({
                        id: Date.now().toString(),
                        type: 'referral',
                        amount: commission,
                        status: 'completed',
                        createdAt: new Date().toISOString(),
                        description: `Referral commission from ${currentUser.email}`
                    });
                    
                    // Update referrer in users array
                    const referrerIndex = users.findIndex(u => u.id === referrer.id);
                    if (referrerIndex !== -1) {
                        users[referrerIndex] = referrer;
                    }
                    
                    showToast(`+$${commission.toFixed(2)} referral commission added!`, 'success');
                }
            }
            
            // Update user in users array
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            if (userIndex !== -1) {
                users[userIndex] = currentUser;
            }
            
            localStorage.setItem('EWT_users', JSON.stringify(users));
            localStorage.setItem('EWT_currentUser', JSON.stringify(currentUser));
            
            showToast('Deposit submitted! Processing...', 'success');
            
            // Simulate processing
            setTimeout(() => {
                // Update transaction status to completed
                const transaction = currentUser.transactions[currentUser.transactions.length - 1];
                transaction.status = 'completed';
                
                // Update in localStorage
                localStorage.setItem('EWT_currentUser', JSON.stringify(currentUser));
                
                const updatedUsers = JSON.parse(localStorage.getItem('EWT_users'));
                const updatedUserIndex = updatedUsers.findIndex(u => u.id === currentUser.id);
                if (updatedUserIndex !== -1) {
                    updatedUsers[updatedUserIndex] = currentUser;
                    localStorage.setItem('EWT_users', JSON.stringify(updatedUsers));
                }
                
                updateDashboard(currentUser);
                showToast(`Deposit of $${amount.toFixed(2)} completed!`, 'success');
            }, 3000);
            
            // Reset form
            document.getElementById('deposit-amount').value = '';
            document.getElementById('deposit-receipt').value = '';
            document.getElementById('receipt-preview').style.display = 'none';
            
            showScreen('dashboard-screen');
        }

        function verifyWithdrawCode(code, amount, address) {
            const withdrawCodes = JSON.parse(localStorage.getItem('EWT_withdrawCodes'));
            const codeIndex = withdrawCodes.findIndex(c => c.code === code && !c.used);
            
            if (codeIndex === -1) {
                showToast('Invalid or already used code', 'error');
                document.querySelector('.code-inputs').classList.add('shake');
                setTimeout(() => {
                    document.querySelector('.code-inputs').classList.remove('shake');
                }, 500);
                return;
            }
            
            // Mark code as used
            withdrawCodes[codeIndex].used = true;
            localStorage.setItem('EWT_withdrawCodes', JSON.stringify(withdrawCodes));
            
            // Update user balance
            const currentUser = JSON.parse(localStorage.getItem('EWT_currentUser'));
            const users = JSON.parse(localStorage.getItem('EWT_users'));
            
            // Determine how to deduct the amount (from referral earnings first, then main balance)
            let remainingAmount = amount;
            if (currentUser.referralEarnings?.available > 0) {
                const referralUsed = Math.min(currentUser.referralEarnings.available, remainingAmount);
                currentUser.referralEarnings.available -= referralUsed;
                currentUser.referralEarnings.withdrawn += referralUsed;
                remainingAmount -= referralUsed;
            }
            
            if (remainingAmount > 0) {
                currentUser.balance -= remainingAmount;
            }
            
            currentUser.transactions.push({
                id: Date.now().toString(),
                type: 'withdraw',
                amount,
                status: 'pending',
                createdAt: new Date().toISOString(),
                description: 'Withdrawal to ' + address.substring(0, 8) + '...'
            });
            
            // Update user in users array
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            if (userIndex !== -1) {
                users[userIndex] = currentUser;
            }
            
            localStorage.setItem('EWT_users', JSON.stringify(users));
            localStorage.setItem('EWT_currentUser', JSON.stringify(currentUser));
            
            showToast('Withdrawal submitted! Processing...', 'success');
            
            // Simulate processing
            setTimeout(() => {
                // Update transaction status to completed
                const transaction = currentUser.transactions[currentUser.transactions.length - 1];
                transaction.status = 'completed';
                
                // Update in localStorage
                localStorage.setItem('EWT_currentUser', JSON.stringify(currentUser));
                
                const updatedUsers = JSON.parse(localStorage.getItem('EWT_users'));
                const updatedUserIndex = updatedUsers.findIndex(u => u.id === currentUser.id);
                if (updatedUserIndex !== -1) {
                    updatedUsers[updatedUserIndex] = currentUser;
                    localStorage.setItem('EWT_users', JSON.stringify(updatedUsers));
                }
                
                updateDashboard(currentUser);
                showToast(`Withdrawal of $${amount.toFixed(2)} completed!`, 'success');
            }, 3000);
            
            // Reset form
            document.getElementById('withdraw-amount').value = '';
            document.getElementById('withdraw-address').value = '';
            
            showScreen('dashboard-screen');
        }

        // Withdraw referral earnings
        function withdrawReferralEarnings() {
            const currentUser = JSON.parse(localStorage.getItem('EWT_currentUser'));
            const users = JSON.parse(localStorage.getItem('EWT_users'));
            
            if (!currentUser.referralEarnings || currentUser.referralEarnings.available <= 0) {
                showToast('No available referral earnings to withdraw', 'error');
                return;
            }
            
            const amount = currentUser.referralEarnings.available;
            
            // Move referral earnings to main balance
            currentUser.balance += amount;
            currentUser.referralEarnings.withdrawn += amount;
            currentUser.referralEarnings.available = 0;
            
            currentUser.transactions.push({
                id: Date.now().toString(),
                type: 'referral',
                amount: amount,
                status: 'completed',
                createdAt: new Date().toISOString(),
                description: 'Referral earnings withdrawal'
            });
            
            // Update user in users array
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            if (userIndex !== -1) {
                users[userIndex] = currentUser;
            }
            
            localStorage.setItem('EWT_users', JSON.stringify(users));
            localStorage.setItem('EWT_currentUser', JSON.stringify(currentUser));
            
            updateDashboard(currentUser);
            updateReferralScreen(currentUser);
            showToast(`$${amount.toFixed(2)} referral earnings transferred to main balance!`, 'success');
        }

        // Copy to clipboard function
        function copyToClipboard(text) {
            if (navigator.clipboard) {
                navigator.clipboard.writeText(text).then(() => {
                    showToast('Copied to clipboard!', 'success');
                }).catch(err => {
                    showToast('Failed to copy', 'error');
                });
            } else {
                // Fallback for older browsers
                const textArea = document.createElement("textarea");
                textArea.value = text;
                textArea.style.position = "fixed";
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                
                try {
                    document.execCommand('copy');
                    showToast('Copied to clipboard!', 'success');
                } catch (err) {
                    showToast('Failed to copy', 'error');
                }
                
                document.body.removeChild(textArea);
            }
        }

        // Copy referral code
        function copyReferralCode() {
            const currentUser = JSON.parse(localStorage.getItem('EWT_currentUser'));
            if (currentUser && currentUser.referralCode) {
                copyToClipboard(currentUser.referralCode);
            }
        }
    </script>
</body>
</html>